@model Confluence.Blueprint.Models.SubDepartmentModel

@{
    ViewBag.Title = "Sub Department";
}

@section MenuGroup{

}
@section PageScripts{
<script src="@Url.Content("~/js/assets/jquery.validate.min.js")" type="text/javascript"></script>
<script type="text/javascript" src="@Url.Content("~/js/modern/dialog.js")"></script>
}
@section PageHeader{
<script type="text/javascript">
    PrintTerminology(true, false, false)
</script>
}

        <p>
                Use the form below to modify <script>PrintTerminology(true, true, false)</script>. 
        </p>
        @using (Html.BeginForm(null, null, FormMethod.Get, new { id = "myForm", name = "myForm" }))
        {
            
                    <div>
                        
                        <fieldset>
                        <table>
                            <tbody>
                                <tr>
                                    <td style="width:200px">
                                        <div class="editor-label">
                                            Select <script>PrintTerminology(false, false, true)</script>&nbsp;&nbsp;*
                                            
                                        </div>
                                    </td>
                                    <td>
                                        <div class="input-control select" style="width:380px;">
                                            
                                            
                                                    @if (ViewBag.Departments != null && ViewBag.Departments.Count > 0)
                                                    {
                                                        <select id="dept-list">
                                                        <option value="0" ></option>
                                                        @foreach (Confluence.Blueprint.Models.DepartmentModel s in ViewBag.Departments)
                                                        {
                                                            if(s.SubProcess)
                                                            {
                                                                <option value="@s.DepartmentID" >@s.DepartmentName</option>
                                                            }
                                                            else
                                                            {
                                                                <option value="@s.DepartmentID" disabled="disabled" class="bg-color-blueLight">@s.DepartmentName</option>
                                                            }
                                                        }
                                                        </select>
                                                    }
                                                    else
                                                    {
                                                            <p class="fg-color-red">
                                                                No <script>PrintTerminology(true, true, true)</script> found.
                                                            </p>
                                                    }

                                            <p class="info">(You cannot select the <script>PrintTerminology(false, true, false)</script> with no <script>PrintTerminology(true, true, true)</script>. These are disabled and highlighted by default.)</p>
                                        </div>
                                    </td>
                                 </tr>
                            </tbody>
                        </table>

                    
                            <table>
                            <tbody>
                                <tr>
                                    <td style="width:200px">
                                        <div class="editor-label">
                                            @Html.HiddenFor(m => m.SubDepartmentID, new { id = "hidSubDeptId" })
                                            @Html.HiddenFor(m => m.DepartmentID, new { id = "hidDeptId" })
                                            
                                            <script>PrintTerminology(true, false, false)</script> Name *
                                        </div>
                                    </td>
                                    <td>
                                        <div class="input-control text" style="width:380px;">
                                            @Html.TextBoxFor(m => m.SubDepartmentName, new { placeholder = "Enter department name", id = "SubDepartmentName", name = "SubDepartmentName", @class = "required uppercase" })
                                        </div>
                                    </td>
                                 </tr>
                               
                                <tr>
                                    <td >
                                        <div class="editor-label">
                                             @Html.LabelFor(m => m.SubDepartmentAbbreviate)*
                                        </div>
                                    </td>
                                    <td >
                                         <div class="input-control text" style="width:380px;">
                                        @Html.TextBoxFor(m => m.SubDepartmentAbbreviate, new { placeholder = "Enter abbreviate", id = "SubDepartmentAbbreviate", name = "SubDepartmentCode", @class = "required uppercase", minlength = "2", maxlength = "4" })
                                    </div>
                                    </td>
                                 </tr>
                                
                                <tr>
                                    <td >
                                        <div class="editor-label">
                                             @Html.LabelFor(m => m.HODName)*
                                        </div>
                                    </td>
                                    <td >
                                         <div class="input-control text" style="width:380px;">
                                            @Html.TextBoxFor(m => m.HODName, new { placeholder = "Enter HOD name", id = "HODName", name = "HODName", @class = "required uppercase" })
                                        </div>
                                   
                                    </td>
                                 </tr>
                                <tr>
                                    <td >
                                        <div class="editor-label">
                                             @Html.LabelFor(m => m.LLNumber)
                                        </div>
                                    </td>
                                    <td >
                                         <div class="input-control text" style="width:380px;">
                                            @Html.TextBoxFor(m => m.LLNumber, new { placeholder = "Enter land line number", id = "Phone", name = "Phone", @class = "digits", minlength = "10", maxlength = "11" })
                                        </div>
                                   
                                    </td>
                                 </tr>
                                <tr>
                                    <td >
                                        <div class="editor-label">
                                             @Html.LabelFor(m => m.MobileNumber)
                                        </div>
                                    </td>
                                    <td >
                                         <div class="input-control text" style="width:380px;">
                                            @Html.TextBoxFor(m => m.MobileNumber, new { placeholder = "Enter HOD mobile", id = "Mobile", name = "Mobile", @class = "digits", minlength = "10", maxlength = "10" })
                                        </div>
                                   
                                    </td>
                                 </tr>
                                <tr>
                                    <td >
                                        <div class="editor-label">
                                             @Html.LabelFor(m => m.EmailId)*
                                        </div>
                                    </td>
                                    <td >
                                         <div class="input-control text" style="width:380px;">
                                            @Html.TextBoxFor(m => m.EmailId, new { placeholder = "Enter HOD email", id = "Email", name = "Email", @class = "required email" })
                                        </div>
                                   
                                    </td>
                                 </tr>
                                
                            </tbody>
                        </table>
                        <fieldset>
                        <legend>Approval Workflow</legend>
                        <div id="reviewer-info">
                        <table>
                            <tbody>
                                <tr>
                                    <td style="width:200px">
                                        <div class="editor-label">
                                             @Html.LabelFor(m => m.ReviewerName)*
                                        </div>
                                    </td>
                                    <td >
                                         <div class="input-control text" style="width:380px;">
                                            @Html.TextBoxFor(m => m.ReviewerName, new { placeholder = "Enter reviewer name", id = "ReviewerName", name = "ReviewerName" , @class = "required uppercase"})
                                        </div>
                                   
                                    </td>
                                 </tr>
                                <tr>
                                    <td >
                                        <div class="editor-label">
                                             @Html.LabelFor(m => m.ReviewerLLNumber)
                                        </div>
                                    </td>
                                    <td >
                                         <div class="input-control text" style="width:380px;">
                                            @Html.TextBoxFor(m => m.ReviewerLLNumber, new { placeholder = "Enter reviewer phone", id = "ReviewerPhone", name = "ReviewerPhone", @class = "digits", minlength = "10", maxlength = "11" })
                                        </div>
                                   
                                    </td>
                                 </tr>
                                <tr>
                                    <td >
                                        <div class="editor-label">
                                             @Html.LabelFor(m => m.ReviewerMobileNumber)
                                        </div>
                                    </td>
                                    <td >
                                         <div class="input-control text" style="width:380px;">
                                            @Html.TextBoxFor(m => m.ReviewerMobileNumber, new { placeholder = "Enter reviewer mobile", id = "ReviewerMobile", name = "ReviewerMobile", @class = "digits", minlength = "10", maxlength = "10" })
                                        </div>
                                   
                                    </td>
                                 </tr>
                                <tr>
                                    <td >
                                        <div class="editor-label">
                                             @Html.LabelFor(m => m.ReviewerEmailID)*
                                        </div>
                                    </td>
                                    <td >
                                         <div class="input-control text" style="width:380px;">
                                            @Html.TextBoxFor(m => m.ReviewerEmailID, new { placeholder = "Enter reviewer email", id = "ReviewerEmail", name = "ReviewerEmail", @class = "email required" })
                                        </div>
                                   
                                    </td>
                                 </tr>
                                
                                <tr>
                                    <td >
                                        <div class="editor-label">
                                             @Html.LabelFor(m => m.IsHODApprover)
                                        </div>
                                    </td>
                                    <td >
                                            <label class="input-control radio">
                                                @Html.RadioButtonFor(m => m.IsHODApprover, true, new { id = "hod-approver-yes", name = "IsHODApprover" })
                                                <span class="helper">Yes</span>
                                            </label>
                                            <label class="input-control radio">
                                                @Html.RadioButtonFor(m => m.IsHODApprover, false, new { id = "hod-approver-no", name = "IsHODApprover" })
                                                <span class="helper">No</span>
                                            </label>
                                    </td>
                                 </tr>
                                </tbody>
                        </table>
                        </div>

                        <div id="approver-info">
                        <table>
                            <tbody>
                            <tr>
                                <td style="width:200px">
                                    <div class="editor-label">
                                            @Html.LabelFor(m => m.ApproverName)*
                                    </div>
                                </td>
                                <td >
                                        <div class="input-control text" style="width:380px;">
                                        @Html.TextBoxFor(m => m.ApproverName, new { placeholder = "Enter approver name", id = "ApproverName", name = "ApproverName", @class="required uppercase" })
                                    </div>
                                   
                                </td>
                                </tr>
                            <tr>
                                <td >
                                    <div class="editor-label">
                                            @Html.LabelFor(m => m.ApproverLLNumber)
                                    </div>
                                </td>
                                <td >
                                        <div class="input-control text" style="width:380px;">
                                        @Html.TextBoxFor(m => m.ApproverLLNumber, new { placeholder = "Enter approver phone", id = "ApproverPhone", name = "ApproverPhone", @class = "digits", minlength = "10", maxlength = "11" })
                                    </div>
                                   
                                </td>
                                </tr>
                            <tr>
                                <td >
                                    <div class="editor-label">
                                            @Html.LabelFor(m => m.ApproverMobileNumber)
                                    </div>
                                </td>
                                <td >
                                        <div class="input-control text" style="width:380px;">
                                        @Html.TextBoxFor(m => m.ApproverMobileNumber, new { placeholder = "Enter approver mobile", id = "ApproverMobile", name = "ApproverMobile", @class = "digits", minlength = "10", maxlength = "10" })
                                    </div>
                                   
                                </td>
                                </tr>
                            <tr>
                                <td >
                                    <div class="editor-label">
                                            @Html.LabelFor(m => m.ApproverEmailID)*
                                    </div>  
                                </td>
                                <td >
                                        <div class="input-control text" style="width:380px;">
                                        @Html.TextBoxFor(m => m.ApproverEmailID, new { placeholder = "Enter approver email", id = "ApproverEmail", name = "ApproverEmail", @class = "email required" })
                                    </div>
                                   
                                </td>
                                </tr>
                            <tr>
                                <td colspan="2">
                                    <input class="command-button default" type="button" value="Update" id="save" />
                                    <input type="button" value="Cancel" id="cancel"/>
                                   
                                </td>
                            </tr>
                            </tbody>
                        </table>
                        </div>
                        </fieldset>
                    
                        </fieldset>
                    </div>

        }
@section PageFooterScripts{
<script type="text/javascript">
    $(document).ready(function () {
        // set selected department value
        $('#dept-list').val($("#hidDeptId").val());
        
        $("#dept-list").change(function () {
            $("#hidDeptId").val($(this).val());
        });

        // auto fill if hod approver checked
        $("#HODName").bind("change paste keyup", function () {
            if ($('#hod-approver-yes').prop('checked'))
                $('#ApproverName').val($('#HODName').val());
        });
        $("#Phone").bind("change paste keyup", function () {
            if ($('#hod-approver-yes').prop('checked'))
                $('#ApproverPhone').val($('#Phone').val());
        });
        $("#Mobile").bind("change paste keyup", function () {
            if ($('#hod-approver-yes').prop('checked'))
                $('#ApproverMobile').val($('#Mobile').val());
        });
        $("#Email").bind("change paste keyup", function () {
            if ($('#hod-approver-yes').prop('checked'))
                $('#ApproverEmail').val($('#Email').val());
        });

        $('#hod-approver-yes').change(function () {
            // copy fields to approver
            $('#ApproverName').val($('#HODName').val());
            $('#ApproverPhone').val($('#Phone').val());
            $('#ApproverMobile').val($('#Mobile').val());
            $('#ApproverEmail').val($('#Email').val());
            $('#approver-info input:text').attr('disabled', 'disabled').prop('disabled', 'disabled');
        });
        $('#hod-approver-no').change(function () {
            $('#approver-info input:text').removeAttr('disabled').val('');
        });

        $('#save').click(function (e) {
            var IsFormValid = $("#myForm").valid();

            if (IsFormValid) {

                var valHODApprover = $('input[name="IsHODApprover"]:checked').val();
                // build json request
                var modelObj = {
                    "model": {
                        "DepartmentID": $("#hidDeptId").val(),
                        "SubDepartmentID": $("#hidSubDeptId").val(),
                        "SubDepartmentName": $("#SubDepartmentName").val(),
                        "SubDepartmentAbbreviate": $("#SubDepartmentAbbreviate").val(),
                        "HODName": $("#HODName").val(),
                        "LLNumber": $("#Phone").val(),
                        "MobileNumber": $("#Mobile").val(),
                        "EmailId": $("#Email").val(),
                        "ReviewerName": $("#ReviewerName").val(),
                        "ReviewerLLNumber": $("#ReviewerPhone").val(),
                        "ReviewerMobileNumber": $("#ReviewerMobile").val(),
                        "ReviewerEmailID": $("#ReviewerEmail").val(),
                        "IsHODApprover": valHODApprover,
                        "ApproverName": $("#ApproverName").val(),
                        "ApproverLLNumber": $("#ApproverPhone").val(),
                        "ApproverMobileNumber": $("#ApproverMobile").val(),
                        "ApproverEmailID": $("#ApproverEmail").val()
                    }
                };

                $.ajax({
                    type: "POST",
                    url: "/Admin/SubDepartment/Save",
                    data: JSON.stringify(modelObj),
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: function (data) {
                        var jsonObj = '';
                        if (data.hasOwnProperty("d")) {
                            jsonObj = $.parseJSON(data.d);
                        }
                        else {
                            jsonObj = $.parseJSON(data);
                        }
                        if (jsonObj != '' && jsonObj.Error && jsonObj.Error != '') {
                            $.alert(jsonObj.Error, "Error", "Error");

                        }
                        else if (jsonObj != '' && jsonObj.Name != '') {
                            // Display  confirmation dialog
                            $.redirect('@Url.Content("~/Admin")', "Success", jsonObj.Name + " Sub-Dept successfully updated");
                        }

                    },
                    error: function (XMLHttpRequest, textStatus, errorThrown) {
                        
                        $.alert("responseText=" + XMLHttpRequest.responseText + "\n textStatus=" + textStatus + "\n errorThrown=" + errorThrown, "Error", "Error");
                    }
                });

            }
        });
        $('#cancel').click(function (e) {
            $.redirect('@Url.Content("~/Admin")', "Warning", "Sub-Department updation cancelled");
        });
    });
        
    </script>
}
 
